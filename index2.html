<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>


</head>
<body>
<select id="timeIntervall">
    <option value="1">1m</option>
    <option value="2">5m</option>
    <option value="3">1H</option>
    <option value="3">1d</option>
    <option value="3">1M</option>
</select>

<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<script>
        var socket = io.connect("http://23.99.96.65:8082")
//    var socket = io.connect("http://localhost:3000");

    $(function () {
        $('#timeIntervall').change(function (event) {
            console.log($(this).val());

            if ($(this).val() == 1) {
                socket.emit("message1m", "Hello 1");
            } else if ($(this).val() == 2) {
                socket.emit("message5m", "Hello 2");
            }


        });
    })

    function drawData(data) {
        var dataX = []
        var dataSubY = []
        var keys = Object.keys(data);
        for (var i = keys.length - 1; i >= 0; i--) {
            var dateString = data[keys[i]].date_min
            var year = dateString.substring(0, 4);
            var month = dateString.substring(4, 6);
            var day = dateString.substring(6, 8);
            var hour = dateString.substring(8, 10);
            var minute = dateString.substring(10, 12);
            var date = new Date(year, month, day, hour, minute)
            date.setHours(date.getHours() + 7)
            dataX.push(date.getHours() + ":" + date.getMinutes())
            dataSubY.push(data[keys[i]].value);

        }
        var dataY = [{
            name: 'All',
            data: dataSubY
        }]

        $('#container').highcharts({

            title: {
                text: 'Monthly Average Session',
                x: -20 //center
            },
            subtitle: {
                text: 'Source: Nginx and Wowza Stream',
                x: -20
            },

            xAxis: {
                categories: dataX
            },
            yAxis: {
                title: {
                    text: 'Unique count of session'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ' session'
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: dataY
        });
    }

    $(function () {
        socket.on("1m", function (data) {
            console.log(data)
            drawData(data)

        })

        socket.on("5m", function (data) {
            console.log(data)
            drawData(data)

        })

    });

</script>


</body>
</html>